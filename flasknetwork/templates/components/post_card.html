{% macro render_post_card(post, show_course_badge=True, return_to=None) %}
{% set post_url = url_for('posts.post', post_id=post.id, return_to=return_to) if return_to else url_for('posts.post', post_id=post.id) %}
{% set rating_value = post.rating or 0 %}
<article class="position-relative content-section post-section">
    <div class="d-flex align-items-start">
        <div class="flex-grow-1">
            <div class="d-flex justify-content-between align-items-start">
                <div class="post-title-container">

                    <div class="d-flex align-items-center text-theme-primary small mt-1">
                        <img class="review-img-mobile me-2" src="{{ url_for('static', filename='profile_pics/' + post.author.image_file) }}" alt="{{ post.author.username }}">
                        <div>
                            By <a class="text-decoration-none fw-bold author-link" href="{{ url_for('users.user_posts', username=post.author.username) }}">{{ post.author.username }}</a>
                            <span class="mx-1">â€¢</span>
                            {{ post.date_posted.strftime('%b %d, %Y') }}
                        </div>
                    </div>
                </div>
                
                <div class="post-rating-badge badge p-2 {{ 'badge-filled' if rating_value == 5 }}">
                    {% for i in range(1, 6) %}
                        {% if rating_value >= i %}
                            <i class="fas fa-star"></i>
                        {% else %}
                            <i class="far fa-star"></i>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>

            {% if show_course_badge %}
            <div class="mt-2">
                <a class="badge badge-course" href="{{ url_for('courses.course_detail', course_id=post.course.id) }}">{{ post.course.code }} - {{ post.course.name }}</a>
            </div>
            {% endif %}

            {% if post.tags %}
                <div class="mt-2 d-flex flex-wrap gap-1">
                    {% for tag in post.tags %}
                        <span class="tag-chip tag-chip-small tag-chip-static tag-{{ tag.sentiment.value }}">{{ tag.name }}</span>
                    {% endfor %}
                </div>
            {% endif %}

            {% if post.content %}
                <div class="mt-3">
                    <p class="content-preview text-theme-primary mb-0">{{ post.get_content_preview() }}</p>
                </div>
            {% endif %}
        </div>
    </div>
    
    <div class="mt-3 text-end">
         <a href="{{ post_url }}" class="btn btn-sm btn-xs btn-dimmed btn-outline-primary post-link-mobile">
             <span class="d-none d-md-inline">Full Review</span>
             <span class="d-md-none">></span>
         </a>
    </div>
</article>
{% endmacro %}
